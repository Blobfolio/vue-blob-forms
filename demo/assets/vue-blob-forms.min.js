!function(){var BlobFormsVue={};BlobFormsVue.install=function(Vue,options){function _validateForm(el,touch){var name=_isForm(el);if(!name||void 0===$scope[name]||$scope[name].blobForms[name].$lock)return!1;Vue.set($scope[name].blobForms[name],"$lock",!0),touch=!!touch;var fieldKeys=Object.keys($scope[name].blobForms[name].fields);for(i=0;i<fieldKeys.length;i++)_validateField(el,$scope[name].blobForms[name].fields[fieldKeys[i]].el,touch);return Vue.set($scope[name].blobForms[name],"$lock",!1),Vue.nextTick(function(){_updateFormClasses(el)}),!0}function _validateField(form,field,touch){var name=_isForm(form);if(!name||void 0===$scope[name])return!1;var fieldName=_isField(field);if(!field)return!1;touch=!!touch;var fieldValue=field.value||field.getAttribute("value")||"",data=$scope[name].blobForms[name].fields[fieldName];if(data.$lock)return!1;Vue.set($scope[name].blobForms[name].fields[fieldName],"$lock",!0),touch&&!data.touched&&Vue.set($scope[name].blobForms[name].fields[fieldName],"touched",!0);var changed=_checksum(fieldValue)!==data.originalValue;changed!==data.changed&&Vue.set($scope[name].blobForms[name].fields[fieldName],"changed",changed);var valid=!1;if(_resetValidity(field),void 0===field.willValidate||field.checkValidity?valid=!0:data.touched||field.validity.valueMissing&&(valid=!0,_resetValidity(field)),fieldValue.length&&valid&&"email"===field.getAttribute("type")&&((valid=!!regexEmail.test(fieldValue))||field.setCustomValidity("Please enter a complete email address.")),valid){var fieldCallback=field.dataset.validationCallback||field.getAttribute("validation-callback")||!1;if(fieldCallback&&"function"==typeof $scope[name][fieldCallback]){var callbackResponse=$scope[name][fieldCallback](fieldValue);!0!==callbackResponse&&(valid=!1,"string"==typeof callbackResponse&&callbackResponse.length?field.setCustomValidity(callbackResponse):field.setCustomValidity("This input is not valid."))}}return valid?(_resetValidity(field),$scope[name].blobForms[name].errors[fieldName]&&Vue.delete($scope[name].blobForms[name].errors,fieldName)):Vue.set($scope[name].blobForms[name].errors,fieldName,field.validationMessage),Vue.set($scope[name].blobForms[name].fields[fieldName],"valid",valid),field.classList.toggle("is-valid",data.valid),field.classList.toggle("is-invalid",!data.valid),field.classList.toggle("is-touched",data.touched),field.classList.toggle("is-changed",data.changed),Vue.set($scope[name].blobForms[name].fields[fieldName],"$lock",!1),$scope[name].blobForms[name].$lock||Vue.nextTick(function(){_updateFormClasses(form)}),data.valid}function _resetValidity(el){try{field.checkValidity(),field.setCustomValidity("")}catch(Ex){return!1}}function _updateFormClasses(el){var name=_isForm(el);if(!name)return!1;el.classList.toggle("is-valid",-1!==$scope[name].blobFormsStatuses.valid.indexOf(name)),el.classList.toggle("is-invalid",-1===$scope[name].blobFormsStatuses.valid.indexOf(name)),el.classList.toggle("is-touched",-1!==$scope[name].blobFormsStatuses.touched.indexOf(name)),el.classList.toggle("is-changed",-1!==$scope[name].blobFormsStatuses.changed.indexOf(name))}function _isForm(el){if(!el.nodeName||"FORM"!==el.nodeName)return!1;var name=el.getAttribute("name")||"";return name||!1}function _isField(el){if(!el.nodeName||"INPUT"!==el.nodeName&&"SELECT"!==el.nodeName&&"TEXTAREA"!==el.nodeName)return!1;var name=el.getAttribute("name")||"";return name||!1}function _getFields(el){if(!1===_isForm(el))return!1;var fields=el.querySelectorAll("input, select, textarea");if(!fields)return!1;for(var out=[],i=0;i<fields.length;i++)(fields[i].getAttribute("name")||"")&&out.push(fields[i]);return!!out.length&&out}function _loadFields(el){var name=_isForm(el);if(!1===name)return!1;var fields=_getFields(el);if(!1===fields)return Vue.set($scope[name].blobForms[name],"fields",{}),!1;var fieldNames=[];for(i=0;i<fields.length;i++){var fieldName=fields[i].getAttribute("name")||"";fieldName&&(void 0===$scope[name].blobForms[name].fields[fieldName]&&(!0,Vue.set($scope[name].blobForms[name].fields,fieldName,{name:fieldName,el:fields[i],originalValue:_checksum(fields[i].value),changed:!1,touched:!1,valid:!0,$lock:!1}),fieldNames.push(fieldName)))}var fieldKeys=Object.keys($scope[name].blobForms[name].fields);if(fieldKeys.length!==fieldNames.length)for(i=0;i<fieldKeys.length;i++)-1===fieldNames.indexOf(fieldKeys[i])&&(!0,Vue.delete($scope[name].blobForms[name].fields,fieldKeys[i]));return!0}function _checksum(value){if("object"==typeof value)try{value=JSON.stringify(value)}catch(Ex){return 0}var i,hash=0,strlen=value.length;if(!strlen)return hash;for(i=0;i<strlen;i++)hash=(hash<<5)-hash+value.charCodeAt(i),hash&=hash;return hash}var regexEmail=new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),$scope={};Vue.prototype.blobForms={},Vue.mixin({computed:{blobFormsStatuses:function(){console.log("calculating");var out={changed:[],valid:[],touched:[]},forms=Object.keys(this.blobForms);for(i=0;i<forms.length;i++){var changed=!1,valid=!0,touched=!1,fields=Object.keys(this.blobForms[forms[i]].fields);for(j=0;j<fields.length;j++)!changed&&this.blobForms[forms[i]].fields[fields[j]].changed&&(changed=!0,out.changed.push(forms[i])),valid&&!this.blobForms[forms[i]].fields[fields[j]].valid&&(valid=!1),!touched&&this.blobForms[forms[i]].fields[fields[j]].touched&&(touched=!0,out.touched.push(forms[i])),changed&&!valid&&touched&&(j=fields.length);valid&&out.valid.push(forms[i])}return out}}}),Vue.directive("blobForms",{id:"blobForms",priority:5e4,inserted:function(el,binding,vnode){var name=_isForm(el);if(name)return el.setAttribute("novalidate",!0),$scope[name]=vnode.context,Vue.set(vnode.context.blobForms,name,{name:name,el:el,fields:{},errors:{},changed:!1,touched:!1,valid:!0,$lock:!1}),new MutationObserver(function(mutations){Vue.nextTick(function(){_loadFields(el)})}).observe(el,{childList:!0,subtree:!0}),el.addEventListener("input",function(e){Vue.nextTick(function(){!1!==_isField(e.target)&&_validateField(el,e.target)})}),Vue.nextTick(function(){_loadFields(el),Vue.nextTick(function(){_validateForm(el)})}),!0}})},"undefined"!=typeof window&&window.Vue&&window.Vue.use(BlobFormsVue)}();